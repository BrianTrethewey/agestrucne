\hypertarget{namespacenegui_1_1pgutilities}{}\section{negui.\+pgutilities Namespace Reference}
\label{namespacenegui_1_1pgutilities}\index{negui.\+pgutilities@{negui.\+pgutilities}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespacenegui_1_1pgutilities_a20a66168135d35b6713e38b2503f6289}{do\+\_\+usage\+\_\+check} (ls\+\_\+this\+\_\+argv, ls\+\_\+required\+\_\+arg\+\_\+descriptions, ls\+\_\+optional\+\_\+arg\+\_\+descriptions=\mbox{[}$\,$\mbox{]}, b\+\_\+multi\+\_\+line\+\_\+msg=False, b\+\_\+unlimited\+\_\+final\+\_\+args=False, s\+\_\+note=None)
\item 
def {\bfseries get\+\_\+date\+\_\+time\+\_\+string\+\_\+dotted} ()\hypertarget{namespacenegui_1_1pgutilities_a926d8ee0bffed0d961dcfc3d169e05a4}{}\label{namespacenegui_1_1pgutilities_a926d8ee0bffed0d961dcfc3d169e05a4}

\item 
def {\bfseries is\+\_\+file\+\_\+and\+\_\+executable} (s\+\_\+path)\hypertarget{namespacenegui_1_1pgutilities_a8a347fe70cfaae23658adb58cd312e93}{}\label{namespacenegui_1_1pgutilities_a8a347fe70cfaae23658adb58cd312e93}

\item 
def {\bfseries confirm\+\_\+executable\+\_\+is\+\_\+in\+\_\+path} (s\+\_\+exectuable\+\_\+file\+\_\+name)\hypertarget{namespacenegui_1_1pgutilities_a8fe3f14ed21663af6196c0c53349c536}{}\label{namespacenegui_1_1pgutilities_a8fe3f14ed21663af6196c0c53349c536}

\item 
def {\bfseries manage\+\_\+process\+\_\+queue} (o\+\_\+queue\+\_\+with\+\_\+target\+\_\+calls, o\+\_\+queue\+\_\+to\+\_\+hold\+\_\+results=None)\hypertarget{namespacenegui_1_1pgutilities_a2096f66a8484e74902fb97c787c79345}{}\label{namespacenegui_1_1pgutilities_a2096f66a8484e74902fb97c787c79345}

\item 
def \hyperlink{namespacenegui_1_1pgutilities_a33737d6b655651fd586e77e269300eb4}{prep\+\_\+and\+\_\+call\+\_\+do\+\_\+pgopsimupop\+\_\+replicate} (s\+\_\+config\+\_\+file, s\+\_\+life\+\_\+table\+\_\+files, s\+\_\+param\+\_\+file, s\+\_\+output\+\_\+base\+\_\+name, s\+\_\+replicate\+\_\+number)
\begin{DoxyCompactList}\small\item\em end do\+\_\+sim\+\_\+replicate\+\_\+on\+\_\+separate\+\_\+os\+\_\+process \end{DoxyCompactList}\item 
def \hyperlink{namespacenegui_1_1pgutilities_af3612d8b0b5d45a71109ea49eec4f9b0}{do\+\_\+pgopsimupop\+\_\+replicate\+\_\+from\+\_\+files} (s\+\_\+configuration\+\_\+file, ls\+\_\+life\+\_\+table\+\_\+files, s\+\_\+param\+\_\+name\+\_\+file, s\+\_\+outfile\+\_\+basename, i\+\_\+replicate\+\_\+number)
\item 
def \hyperlink{namespacenegui_1_1pgutilities_aa37c7d125e4eaec2eeea639f53fa140d}{remove\+\_\+simulation\+\_\+replicate\+\_\+output\+\_\+files} (s\+\_\+basename)
\item 
def {\bfseries get\+\_\+class\+\_\+names\+\_\+immediate\+\_\+parent} (o\+\_\+object)\hypertarget{namespacenegui_1_1pgutilities_a6ab2e254a7954f6a3ad216cbbb18436c}{}\label{namespacenegui_1_1pgutilities_a6ab2e254a7954f6a3ad216cbbb18436c}

\item 
def {\bfseries get\+\_\+current\+\_\+working\+\_\+directory} ()\hypertarget{namespacenegui_1_1pgutilities_ada6bbd0893b0b9ecea89245329058e30}{}\label{namespacenegui_1_1pgutilities_ada6bbd0893b0b9ecea89245329058e30}

\item 
def {\bfseries get\+\_\+listdir} (s\+\_\+parent\+\_\+dir)\hypertarget{namespacenegui_1_1pgutilities_a46ba7adf1f3b80ee22ab635fa22ec8fa}{}\label{namespacenegui_1_1pgutilities_a46ba7adf1f3b80ee22ab635fa22ec8fa}

\item 
def {\bfseries does\+\_\+exist\+\_\+and\+\_\+is\+\_\+file} (s\+\_\+file)\hypertarget{namespacenegui_1_1pgutilities_a1be11f0c22a8f0b3cd2574ba02c2e04a}{}\label{namespacenegui_1_1pgutilities_a1be11f0c22a8f0b3cd2574ba02c2e04a}

\item 
def {\bfseries get\+\_\+list\+\_\+subdirectories} (s\+\_\+parent\+\_\+dir)\hypertarget{namespacenegui_1_1pgutilities_aa598e123d913111c3f191c0a725b57fd}{}\label{namespacenegui_1_1pgutilities_aa598e123d913111c3f191c0a725b57fd}

\item 
def {\bfseries get\+\_\+list\+\_\+file\+\_\+objects} (s\+\_\+parent\+\_\+dir)\hypertarget{namespacenegui_1_1pgutilities_ad045331ad9e74cc1d8fdc2a8c2b050af}{}\label{namespacenegui_1_1pgutilities_ad045331ad9e74cc1d8fdc2a8c2b050af}

\item 
def {\bfseries get\+\_\+list\+\_\+files\+\_\+and\+\_\+dirs\+\_\+from\+\_\+glob} (s\+\_\+glob)\hypertarget{namespacenegui_1_1pgutilities_aa5d355d2c26bf4992ce682449dfb93fc}{}\label{namespacenegui_1_1pgutilities_aa5d355d2c26bf4992ce682449dfb93fc}

\item 
def {\bfseries get\+\_\+basename\+\_\+from\+\_\+path} (s\+\_\+path)\hypertarget{namespacenegui_1_1pgutilities_abbecfce3431917f0ed764bc056b04fdc}{}\label{namespacenegui_1_1pgutilities_abbecfce3431917f0ed764bc056b04fdc}

\item 
def {\bfseries get\+\_\+dirname\+\_\+from\+\_\+path} (s\+\_\+path)\hypertarget{namespacenegui_1_1pgutilities_ae147f21f478f594d3e696d9198fa999b}{}\label{namespacenegui_1_1pgutilities_ae147f21f478f594d3e696d9198fa999b}

\item 
def {\bfseries remove\+\_\+files} (ls\+\_\+files)\hypertarget{namespacenegui_1_1pgutilities_ab276fa71e3e15636a51644dcb4f395ba}{}\label{namespacenegui_1_1pgutilities_ab276fa71e3e15636a51644dcb4f395ba}

\item 
def {\bfseries get\+\_\+separator\+\_\+character\+\_\+for\+\_\+current\+\_\+os} ()\hypertarget{namespacenegui_1_1pgutilities_a58912c5a49fed034b7899bae2763ea42}{}\label{namespacenegui_1_1pgutilities_a58912c5a49fed034b7899bae2763ea42}

\item 
def {\bfseries is\+\_\+windows\+\_\+platform} ()\hypertarget{namespacenegui_1_1pgutilities_afc489aeb6d08669a944cea475609c3ab}{}\label{namespacenegui_1_1pgutilities_afc489aeb6d08669a944cea475609c3ab}

\item 
def {\bfseries fix\+\_\+windows\+\_\+path} (s\+\_\+path)\hypertarget{namespacenegui_1_1pgutilities_a84406a87eec039d98e307a1e716b033d}{}\label{namespacenegui_1_1pgutilities_a84406a87eec039d98e307a1e716b033d}

\item 
def \hyperlink{namespacenegui_1_1pgutilities_afb5f5345fa17095a87638daf969f4ebb}{do\+\_\+operation\+\_\+outside} (o\+\_\+multiprocessing\+\_\+event, i\+\_\+input\+\_\+reps, i\+\_\+total\+\_\+processes\+\_\+for\+\_\+sims, s\+\_\+temp\+\_\+config\+\_\+file\+\_\+for\+\_\+running\+\_\+replicates, ls\+\_\+life\+\_\+table\+\_\+files, s\+\_\+param\+\_\+names\+\_\+file, s\+\_\+output\+\_\+basename)
\item 
def {\bfseries get\+\_\+cpu\+\_\+count} ()\hypertarget{namespacenegui_1_1pgutilities_a651d0e76f36897c5ca20e6d40d1a46a7}{}\label{namespacenegui_1_1pgutilities_a651d0e76f36897c5ca20e6d40d1a46a7}

\item 
def \hyperlink{namespacenegui_1_1pgutilities_aa839d4997d2bd2c15016c33cc7fce3b0}{dialog\+\_\+returns\+\_\+nothing} (v\+\_\+return\+\_\+value)
\item 
def \hyperlink{namespacenegui_1_1pgutilities_aed0f15b22462914445ffe1ec2a77cbc8}{convert\+\_\+genepop\+\_\+files\+\_\+string\+\_\+to\+\_\+list\+\_\+format} (s\+\_\+genepop\+\_\+files)
\item 
def \hyperlink{namespacenegui_1_1pgutilities_a4e8f98e83b41d19925860876d274beaa}{run\+\_\+driveneestimator\+\_\+in\+\_\+new\+\_\+process} (o\+\_\+multiprocessing\+\_\+event, s\+\_\+genepop\+\_\+files, qs\+\_\+sample\+\_\+scheme\+\_\+args, f\+\_\+min\+\_\+allele\+\_\+freq, i\+\_\+replicates, s\+\_\+loci\+\_\+sampling\+\_\+scheme, s\+\_\+loci\+\_\+sampling\+\_\+scheme\+\_\+param, i\+\_\+min\+\_\+loci\+\_\+position, i\+\_\+max\+\_\+loci\+\_\+position, i\+\_\+max\+\_\+total\+\_\+loci, i\+\_\+num\+\_\+processes, s\+\_\+runmode, s\+\_\+outfile\+\_\+basename, s\+\_\+file\+\_\+delimiter=\char`\"{})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
bool {\bfseries V\+E\+R\+B\+O\+SE} = False\hypertarget{namespacenegui_1_1pgutilities_a274572b1b2788c24df3e269bc2a3f1f7}{}\label{namespacenegui_1_1pgutilities_a274572b1b2788c24df3e269bc2a3f1f7}

\item 
string {\bfseries P\+R\+O\+C\+E\+S\+S\+\_\+\+Q\+U\+E\+U\+E\+\_\+\+S\+T\+O\+P\+\_\+\+S\+I\+GN} = \textquotesingle{}S\+T\+OP\textquotesingle{}\hypertarget{namespacenegui_1_1pgutilities_aed436e1fc2eb29963ea30b17e614fd04}{}\label{namespacenegui_1_1pgutilities_aed436e1fc2eb29963ea30b17e614fd04}

\item 
string {\bfseries S\+I\+M\+U\+L\+A\+T\+I\+O\+N\+\_\+\+O\+U\+T\+P\+U\+T\+\_\+\+F\+I\+L\+E\+\_\+\+R\+E\+P\+L\+I\+C\+A\+T\+E\+\_\+\+T\+AG} = \char`\"{}.r\char`\"{}\hypertarget{namespacenegui_1_1pgutilities_aeca2401751f6dc9cd4acbe9765271e20}{}\label{namespacenegui_1_1pgutilities_aeca2401751f6dc9cd4acbe9765271e20}

\item 
string {\bfseries D\+E\+L\+I\+M\+I\+T\+E\+R\+\_\+\+L\+I\+F\+E\+\_\+\+T\+A\+B\+L\+E\+\_\+\+F\+I\+L\+ES} = \char`\"{},\char`\"{}\hypertarget{namespacenegui_1_1pgutilities_ad2dc8f53cd27db093fc7f1227367d833}{}\label{namespacenegui_1_1pgutilities_ad2dc8f53cd27db093fc7f1227367d833}

\item 
string {\bfseries N\+E\+\_\+\+E\+S\+T\+I\+M\+A\+T\+I\+O\+N\+\_\+\+M\+A\+I\+N\+\_\+\+T\+A\+B\+L\+E\+\_\+\+F\+I\+L\+E\+\_\+\+E\+XT} = \char`\"{}ldne.\+tsv\char`\"{}\hypertarget{namespacenegui_1_1pgutilities_aa78d8e8004985b127644b8c985a2b551}{}\label{namespacenegui_1_1pgutilities_aa78d8e8004985b127644b8c985a2b551}

\item 
string {\bfseries N\+E\+\_\+\+E\+S\+T\+I\+M\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+A\+R\+Y\+\_\+\+O\+U\+T\+P\+U\+T\+\_\+\+F\+I\+L\+E\+\_\+\+E\+XT} = \char`\"{}ldne.\+msgs\char`\"{}\hypertarget{namespacenegui_1_1pgutilities_adfda5d480a10cf273a287871a5aba972}{}\label{namespacenegui_1_1pgutilities_adfda5d480a10cf273a287871a5aba972}

\item 
{\bfseries s\+\_\+exec\+\_\+name} = sys.\+argv\mbox{[} 1 \mbox{]}\hypertarget{namespacenegui_1_1pgutilities_a25b185def2c6bb2698b1927b4a20a904}{}\label{namespacenegui_1_1pgutilities_a25b185def2c6bb2698b1927b4a20a904}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Description
Support defs for the pop gen interface programs.
\end{DoxyVerb}
 

\subsection{Function Documentation}
\index{negui\+::pgutilities@{negui\+::pgutilities}!convert\+\_\+genepop\+\_\+files\+\_\+string\+\_\+to\+\_\+list\+\_\+format@{convert\+\_\+genepop\+\_\+files\+\_\+string\+\_\+to\+\_\+list\+\_\+format}}
\index{convert\+\_\+genepop\+\_\+files\+\_\+string\+\_\+to\+\_\+list\+\_\+format@{convert\+\_\+genepop\+\_\+files\+\_\+string\+\_\+to\+\_\+list\+\_\+format}!negui\+::pgutilities@{negui\+::pgutilities}}
\subsubsection[{\texorpdfstring{convert\+\_\+genepop\+\_\+files\+\_\+string\+\_\+to\+\_\+list\+\_\+format(s\+\_\+genepop\+\_\+files)}{convert_genepop_files_string_to_list_format(s_genepop_files)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+pgutilities.\+convert\+\_\+genepop\+\_\+files\+\_\+string\+\_\+to\+\_\+list\+\_\+format (
\begin{DoxyParamCaption}
\item[{}]{s\+\_\+genepop\+\_\+files}
\end{DoxyParamCaption}
)}\hypertarget{namespacenegui_1_1pgutilities_aed0f15b22462914445ffe1ec2a77cbc8}{}\label{namespacenegui_1_1pgutilities_aed0f15b22462914445ffe1ec2a77cbc8}
\begin{DoxyVerb}pgguineestimator object stores genepop files as a single string.
Each genepop file is delimited by a comma.  This def will
format the string to s_formatted_list, so that pgdriveneestimator.py can 
execute eval( s_formatted_list) and retrieve a python list of file names.
\end{DoxyVerb}
 

Definition at line 596 of file pgutilities.\+py.


\begin{DoxyCode}
596 \textcolor{keyword}{def }\hyperlink{namespacenegui_1_1pgutilities_aed0f15b22462914445ffe1ec2a77cbc8}{convert\_genepop\_files\_string\_to\_list\_format}( s\_genepop\_files
       ):  
597         \textcolor{stringliteral}{'''}
598 \textcolor{stringliteral}{        pgguineestimator object stores genepop files as a single string.}
599 \textcolor{stringliteral}{        Each genepop file is delimited by a comma.  This def will}
600 \textcolor{stringliteral}{        format the string to s\_formatted\_list, so that pgdriveneestimator.py can }
601 \textcolor{stringliteral}{        execute eval( s\_formatted\_list) and retrieve a python list of file names.}
602 \textcolor{stringliteral}{        '''}
603         ls\_files=s\_genepop\_files.split( \textcolor{stringliteral}{","} )
604 
605         ls\_quoted\_file\_names=[ \textcolor{stringliteral}{"'"} + s\_file + \textcolor{stringliteral}{"'"} \textcolor{keywordflow}{for} s\_file \textcolor{keywordflow}{in} ls\_files ]
606 
607         s\_quoted\_files=\textcolor{stringliteral}{","}.join( ls\_quoted\_file\_names )
608 
609         s\_genepop\_files\_formatted\_as\_python\_list= \textcolor{stringliteral}{"["} + s\_quoted\_files + \textcolor{stringliteral}{"]"}
610 
611         \textcolor{keywordflow}{return} s\_genepop\_files\_formatted\_as\_python\_list
612 \textcolor{comment}{#end convert\_genepop\_files\_string\_to\_list\_format}
613 
\end{DoxyCode}
\index{negui\+::pgutilities@{negui\+::pgutilities}!dialog\+\_\+returns\+\_\+nothing@{dialog\+\_\+returns\+\_\+nothing}}
\index{dialog\+\_\+returns\+\_\+nothing@{dialog\+\_\+returns\+\_\+nothing}!negui\+::pgutilities@{negui\+::pgutilities}}
\subsubsection[{\texorpdfstring{dialog\+\_\+returns\+\_\+nothing(v\+\_\+return\+\_\+value)}{dialog_returns_nothing(v_return_value)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+pgutilities.\+dialog\+\_\+returns\+\_\+nothing (
\begin{DoxyParamCaption}
\item[{}]{v\+\_\+return\+\_\+value}
\end{DoxyParamCaption}
)}\hypertarget{namespacenegui_1_1pgutilities_aa839d4997d2bd2c15016c33cc7fce3b0}{}\label{namespacenegui_1_1pgutilities_aa839d4997d2bd2c15016c33cc7fce3b0}
\begin{DoxyVerb}To evaluate return values from askopenfilenames,
askdirectory, askopenfilename, dialog windows.
Note that unlike askopenfile (singular),
an empty tuple is returned by askdirectory when
the diag is cancelled on the first instance it
is invoked, and an empty string thereafter.  
askopenfilenames returns an empty tuple on all cancels.
\end{DoxyVerb}
 

Definition at line 563 of file pgutilities.\+py.


\begin{DoxyCode}
563 \textcolor{keyword}{def }\hyperlink{namespacenegui_1_1pgutilities_aa839d4997d2bd2c15016c33cc7fce3b0}{dialog\_returns\_nothing}( v\_return\_value ):
564 
565     \textcolor{stringliteral}{'''}
566 \textcolor{stringliteral}{    To evaluate return values from askopenfilenames,}
567 \textcolor{stringliteral}{    askdirectory, askopenfilename, dialog windows.}
568 \textcolor{stringliteral}{    Note that unlike askopenfile (singular),}
569 \textcolor{stringliteral}{    an empty tuple is returned by askdirectory when}
570 \textcolor{stringliteral}{    the diag is cancelled on the first instance it}
571 \textcolor{stringliteral}{    is invoked, and an empty string thereafter.  }
572 \textcolor{stringliteral}{    askopenfilenames returns an empty tuple on all cancels.}
573 \textcolor{stringliteral}{    '''} 
574 
575     b\_is\_nothing=\textcolor{keyword}{False}
576 
577     o\_return\_type=type( v\_return\_value )
578 
579     \textcolor{keywordflow}{if} o\_return\_type == tuple:
580         b\_is\_nothing = ( len( v\_return\_value ) == 0 )
581     \textcolor{keywordflow}{elif} o\_return\_type == str:
582         b\_is\_nothing = ( v\_return\_value == \textcolor{stringliteral}{""} )
583     \textcolor{keywordflow}{elif} o\_return\_type == unicode:
584         b\_is\_nothing == \textcolor{stringliteral}{""}
585     \textcolor{keywordflow}{else}:
586         s\_msg = \textcolor{stringliteral}{"In pgutilities, def dialog\_returns\_nothing(), "} \(\backslash\)
587                 + \textcolor{stringliteral}{"Unknown return value type: "} \(\backslash\)
588                 + str( o\_return\_type ) + \textcolor{stringliteral}{"."}
589         \textcolor{keywordflow}{raise} Exception( s\_msg )
590     \textcolor{comment}{#end if return is a tuple, else string, else error}
591 
592     \textcolor{keywordflow}{return} b\_is\_nothing 
593 \textcolor{comment}{#end dialog\_returns\_nothing}
594         
595 
\end{DoxyCode}
\index{negui\+::pgutilities@{negui\+::pgutilities}!do\+\_\+operation\+\_\+outside@{do\+\_\+operation\+\_\+outside}}
\index{do\+\_\+operation\+\_\+outside@{do\+\_\+operation\+\_\+outside}!negui\+::pgutilities@{negui\+::pgutilities}}
\subsubsection[{\texorpdfstring{do\+\_\+operation\+\_\+outside(o\+\_\+multiprocessing\+\_\+event, i\+\_\+input\+\_\+reps, i\+\_\+total\+\_\+processes\+\_\+for\+\_\+sims, s\+\_\+temp\+\_\+config\+\_\+file\+\_\+for\+\_\+running\+\_\+replicates, ls\+\_\+life\+\_\+table\+\_\+files, s\+\_\+param\+\_\+names\+\_\+file, s\+\_\+output\+\_\+basename)}{do_operation_outside(o_multiprocessing_event, i_input_reps, i_total_processes_for_sims, s_temp_config_file_for_running_replicates, ls_life_table_files, s_param_names_file, s_output_basename)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+pgutilities.\+do\+\_\+operation\+\_\+outside (
\begin{DoxyParamCaption}
\item[{}]{o\+\_\+multiprocessing\+\_\+event, }
\item[{}]{i\+\_\+input\+\_\+reps, }
\item[{}]{i\+\_\+total\+\_\+processes\+\_\+for\+\_\+sims, }
\item[{}]{s\+\_\+temp\+\_\+config\+\_\+file\+\_\+for\+\_\+running\+\_\+replicates, }
\item[{}]{ls\+\_\+life\+\_\+table\+\_\+files, }
\item[{}]{s\+\_\+param\+\_\+names\+\_\+file, }
\item[{}]{s\+\_\+output\+\_\+basename}
\end{DoxyParamCaption}
)}\hypertarget{namespacenegui_1_1pgutilities_afb5f5345fa17095a87638daf969f4ebb}{}\label{namespacenegui_1_1pgutilities_afb5f5345fa17095a87638daf969f4ebb}
\begin{DoxyVerb}Failed to get independant initialization of population per-replicate
when i used python's multiprocessing.process objects as hosts for 
running replicates in parallel.  Solution as of now, 
Sat Jul 30 22:38:42 MDT 2016, is to use OS processes via python's 
subprocess module, creating them in this def, which gets its
requisite info needed for the sim from the pgguisimupop instance
that calls this def (this def is called in a new python.multiprocessing.process
instance, in order not to block the gui).

Note that this def was originally inside the pgguisimupop instance that calls it,
but on windows there was a pickling error not seen on linux or Mac.  Moving this
target def for the python.multiprocessing.process outside the pgguisimupop instance
seems to have solved the problem on windows (win 10).

This def manages the replices via creating subprocesses, and 
calling pgutilities.prep_and_call_do_pgopsimupop_replicate.\end{DoxyVerb}
 

Definition at line 403 of file pgutilities.\+py.


\begin{DoxyCode}
403             s\_output\_basename ):
404 
405     \textcolor{stringliteral}{'''}
406 \textcolor{stringliteral}{    Failed to get independant initialization of population per-replicate}
407 \textcolor{stringliteral}{    when i used python's multiprocessing.process objects as hosts for }
408 \textcolor{stringliteral}{    running replicates in parallel.  Solution as of now, }
409 \textcolor{stringliteral}{    Sat Jul 30 22:38:42 MDT 2016, is to use OS processes via python's }
410 \textcolor{stringliteral}{    subprocess module, creating them in this def, which gets its}
411 \textcolor{stringliteral}{    requisite info needed for the sim from the pgguisimupop instance}
412 \textcolor{stringliteral}{    that calls this def (this def is called in a new python.multiprocessing.process}
413 \textcolor{stringliteral}{    instance, in order not to block the gui).}
414 \textcolor{stringliteral}{}
415 \textcolor{stringliteral}{    Note that this def was originally inside the pgguisimupop instance that calls it,}
416 \textcolor{stringliteral}{    but on windows there was a pickling error not seen on linux or Mac.  Moving this}
417 \textcolor{stringliteral}{    target def for the python.multiprocessing.process outside the pgguisimupop instance}
418 \textcolor{stringliteral}{    seems to have solved the problem on windows (win 10).}
419 \textcolor{stringliteral}{}
420 \textcolor{stringliteral}{    This def manages the replices via creating subprocesses, and }
421 \textcolor{stringliteral}{    calling pgutilities.prep\_and\_call\_do\_pgopsimupop\_replicate.}
422 \textcolor{stringliteral}{}
423 \textcolor{stringliteral}{    '''} 
424 
425     s\_life\_tables\_stringified=\textcolor{stringliteral}{","}.join( ls\_life\_table\_files )
426 
427     s\_os\_plaform\_name=platform.system()
428 
429     b\_is\_windows\_os = ( s\_os\_plaform\_name.lower() == \textcolor{stringliteral}{"windows"} )
430     \textcolor{comment}{#if we're on windows, out strings of file}
431     \textcolor{comment}{#paths may be a mangled mix of unix and }
432     \textcolor{comment}{#windows separators -- with errors resulting}
433     \textcolor{comment}{#downstream.  So we standardize:}
434     \textcolor{keywordflow}{if} b\_is\_windows\_os:
435         s\_life\_tables\_stringified= \(\backslash\)
436             fix\_windows\_path( s\_life\_tables\_stringified )
437         s\_param\_names\_file= \(\backslash\)
438             fix\_windows\_path( s\_param\_names\_file )              
439         s\_output\_basename= \(\backslash\)
440             fix\_windows\_path( s\_output\_basename )   
441     \textcolor{comment}{#end if windows, fix file path strings}
442 
443     i\_total\_replicates\_requested=i\_input\_reps
444 
445     i\_max\_processes\_to\_use=i\_total\_processes\_for\_sims
446 
447 
448     \textcolor{comment}{#we use a python command for a -c arg in the Popen command (see below)}
449     \textcolor{comment}{#and these will be the same args for each replicate (we add the rep-number}
450     \textcolor{comment}{#arg below).  We stringify so that they can be Popen command args.  Some}
451     \textcolor{comment}{#are de-stringified by the pgutilities def before sending to pgop-creator}
452     seq\_first\_four\_args\_to\_sim\_call=( s\_temp\_config\_file\_for\_running\_replicates,
453                                     s\_life\_tables\_stringified,
454                                     s\_param\_names\_file,
455                                     s\_output\_basename )
456     
457     i\_total\_replicates\_started=0
458 
459     o\_subprocess\_group=IndependantSubprocessGroup()
460 
461     \textcolor{keywordflow}{while} i\_total\_replicates\_started < i\_total\_replicates\_requested:
462         \textcolor{comment}{#see if we need to cancel:  }
463         \textcolor{keywordflow}{if} o\_multiprocessing\_event.is\_set():
464 
465             \textcolor{keywordflow}{if} VERBOSE:
466                 \textcolor{keywordflow}{print} ( \textcolor{stringliteral}{"received event in setup loop"} )
467             \textcolor{comment}{#end if VERBOSE}
468 
469             o\_subprocess\_group.terminateAllSubprocesses()
470             
471             \hyperlink{namespacenegui_1_1pgutilities_aa37c7d125e4eaec2eeea639f53fa140d}{remove\_simulation\_replicate\_output\_files}( 
      s\_output\_basename )
472 
473             \textcolor{keywordflow}{break}
474 
475         \textcolor{keywordflow}{else}:
476 
477             i\_number\_subprocesses\_alive=o\_subprocess\_group.getTotalAlive()
478 
479             i\_number\_subprocesses\_available= \(\backslash\)
480                     i\_max\_processes\_to\_use-i\_number\_subprocesses\_alive
481 
482             i\_number\_replicates\_to\_go=i\_total\_replicates\_requested - i\_total\_replicates\_started
483 
484             i\_number\_subprocesses\_to\_start=i\_number\_subprocesses\_available
485 
486             \textcolor{comment}{#reduce the number to start if we have fewer reps to go than avail procs:}
487             \textcolor{keywordflow}{if} i\_number\_subprocesses\_available > i\_number\_replicates\_to\_go:
488                     i\_number\_subprocesses\_to\_start = i\_number\_replicates\_to\_go
489             \textcolor{comment}{#end if fewer needed than available}
490 
491             \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range( i\_number\_subprocesses\_to\_start ):
492 
493                 i\_total\_replicates\_started += 1
494                 
495                 \textcolor{comment}{#In the Popen call, rather than rely on a driver python script }
496                 \textcolor{comment}{#that would need to be in PATH, we'll simply}
497                 \textcolor{comment}{#invoke python with a "-c" argument that imports the }
498                 \textcolor{comment}{#pgutilities module and executes the correct def:}
499         
500                 \textcolor{comment}{#complete the set of args used in the command by adding the}
501                 \textcolor{comment}{#replicate number (recall need comma in sequence with single item,}
502                 \textcolor{comment}{#to delineate sequence versus simple expression):}
503                 seq\_complete\_arg\_set=seq\_first\_four\_args\_to\_sim\_call + ( str( i\_total\_replicates\_started ),
       )
504 
505                 \textcolor{stringliteral}{'''}
506 \textcolor{stringliteral}{                in case the negui mods are not in the default python }
507 \textcolor{stringliteral}{                install dirs, then we need to add them to the sys.paths in}
508 \textcolor{stringliteral}{                any  spawned invocation of python exe -- seems that }
509 \textcolor{stringliteral}{                the PYTHONPATH env var known to this parent process }
510 \textcolor{stringliteral}{                is unknown to the "python" invocation via Popen.  }
511 \textcolor{stringliteral}{                We can get for and then add to our new python invocation}
512 \textcolor{stringliteral}{                the path to all negui modules by getting the}
513 \textcolor{stringliteral}{                path to this module:}
514 \textcolor{stringliteral}{                '''}
515                 s\_curr\_mod\_path = os.path.abspath(\_\_file\_\_)
516 
517                 \textcolor{comment}{#path only (stripped off "/utilities.py" )}
518                 \textcolor{comment}{#-- gives path to all negui mods:}
519                 s\_mod\_dir=os.path.dirname( s\_curr\_mod\_path )
520 
521                 \textcolor{comment}{#need to fix the path if we're on windows:}
522                 \textcolor{keywordflow}{if} b\_is\_windows\_os:
523                     s\_mod\_dir=fix\_windows\_path( s\_mod\_dir )
524                 \textcolor{comment}{#end if windows, fix path}
525                 
526                 s\_path\_append\_statements=\textcolor{stringliteral}{"import sys; sys.path.append( \(\backslash\)""} \(\backslash\)
527                         + s\_mod\_dir + \textcolor{stringliteral}{"\(\backslash\)" );"}
528 
529                 s\_python\_command=s\_path\_append\_statements + \textcolor{stringliteral}{"import pgutilities;"} \(\backslash\)
530                                     \textcolor{stringliteral}{"pgutilities.prep\_and\_call\_do\_pgopsimupop\_replicate"} \(\backslash\)
531                                     + \textcolor{stringliteral}{"( \(\backslash\)"%s\(\backslash\)", \(\backslash\)"%s\(\backslash\)", \(\backslash\)"%s\(\backslash\)", \(\backslash\)"%s\(\backslash\)", \(\backslash\)"%s\(\backslash\)" )"} %  seq\_complete\_arg\_set
532 
533                 o\_new\_subprocess=subprocess.Popen( [ \textcolor{stringliteral}{"python"}, \textcolor{stringliteral}{"-c"}, s\_python\_command ] )
534                 o\_subprocess\_group.addSubprocess( o\_new\_subprocess ) 
535             \textcolor{comment}{#end for each idx of new procs}
536         \textcolor{comment}{#end if event is set else not}
537     \textcolor{comment}{#end while preplicates need to be started}
538 
539     \textcolor{comment}{#we don't want to return untill all processes are done.}
540     \textcolor{comment}{#meantime test for cancel-request}
541     i\_total\_still\_alive\_after\_creating\_all=o\_subprocess\_group.getTotalAlive()
542 
543     \textcolor{keywordflow}{while} i\_total\_still\_alive\_after\_creating\_all > 0:
544         \textcolor{keywordflow}{if} o\_multiprocessing\_event.is\_set():
545 
546             \textcolor{keywordflow}{if} VERBOSE:
547                 print( \textcolor{stringliteral}{"received event in final loop"} )
548             \textcolor{comment}{#end if verbose}
549 
550             o\_subprocess\_group.terminateAllSubprocesses()
551             \hyperlink{namespacenegui_1_1pgutilities_aa37c7d125e4eaec2eeea639f53fa140d}{remove\_simulation\_replicate\_output\_files}( 
      s\_output\_basename )
552         \textcolor{comment}{#end if we are to cancel}
553         i\_total\_still\_alive\_after\_creating\_all=o\_subprocess\_group.getTotalAlive()
554     \textcolor{comment}{#end while}
555 
556     \textcolor{keywordflow}{return}
557 \textcolor{comment}{#end \_\_do\_operation\_outside}
558 
\end{DoxyCode}
\index{negui\+::pgutilities@{negui\+::pgutilities}!do\+\_\+pgopsimupop\+\_\+replicate\+\_\+from\+\_\+files@{do\+\_\+pgopsimupop\+\_\+replicate\+\_\+from\+\_\+files}}
\index{do\+\_\+pgopsimupop\+\_\+replicate\+\_\+from\+\_\+files@{do\+\_\+pgopsimupop\+\_\+replicate\+\_\+from\+\_\+files}!negui\+::pgutilities@{negui\+::pgutilities}}
\subsubsection[{\texorpdfstring{do\+\_\+pgopsimupop\+\_\+replicate\+\_\+from\+\_\+files(s\+\_\+configuration\+\_\+file, ls\+\_\+life\+\_\+table\+\_\+files, s\+\_\+param\+\_\+name\+\_\+file, s\+\_\+outfile\+\_\+basename, i\+\_\+replicate\+\_\+number)}{do_pgopsimupop_replicate_from_files(s_configuration_file, ls_life_table_files, s_param_name_file, s_outfile_basename, i_replicate_number)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+pgutilities.\+do\+\_\+pgopsimupop\+\_\+replicate\+\_\+from\+\_\+files (
\begin{DoxyParamCaption}
\item[{}]{s\+\_\+configuration\+\_\+file, }
\item[{}]{ls\+\_\+life\+\_\+table\+\_\+files, }
\item[{}]{s\+\_\+param\+\_\+name\+\_\+file, }
\item[{}]{s\+\_\+outfile\+\_\+basename, }
\item[{}]{i\+\_\+replicate\+\_\+number}
\end{DoxyParamCaption}
)}\hypertarget{namespacenegui_1_1pgutilities_af3612d8b0b5d45a71109ea49eec4f9b0}{}\label{namespacenegui_1_1pgutilities_af3612d8b0b5d45a71109ea49eec4f9b0}
\begin{DoxyVerb}necessitated by fact that python2 (and 3?) was not able to pickle 
a class-instance def to be used to run replicates of the pgopsimupop
doOp().  Python also failed to pickle SWIG-based code used in Simupop.
Thus the better design, in which  multiprocessing Pools would stay  encapsulated 
inside a class object seem problematic, though may be implement-able using 
reg_copy -- but I'm not confident in state of regcopy of imported simuPop code,
and so  I think is the safer solution, though it
does create a depandancy of the pgguisimupop object on this outside def.  

Note that this def runs a simupop operation using all the param values as
given in the config file arg, except for the "reps" attribute, with is reset to 1,
whatever the value in the configuration file.

Tue Jul 26 22:01:07 MDT 2016
updated to be called by a driver that creates a new OS process, then calls this def to do the replicate.  No longer
uses the dv_input_parm_values_by_attribute, but instead relies on reading a complete and up-to-date (i.e. all values
as changed or edited on the gui interface) configuration files (that includes the "life table" params).
\end{DoxyVerb}
 

Definition at line 208 of file pgutilities.\+py.


\begin{DoxyCode}
208                                                 i\_replicate\_number ):
209     \textcolor{stringliteral}{'''}
210 \textcolor{stringliteral}{    necessitated by fact that python2 (and 3?) was not able to pickle }
211 \textcolor{stringliteral}{    a class-instance def to be used to run replicates of the pgopsimupop}
212 \textcolor{stringliteral}{    doOp().  Python also failed to pickle SWIG-based code used in Simupop.}
213 \textcolor{stringliteral}{    Thus the better design, in which  multiprocessing Pools would stay  encapsulated }
214 \textcolor{stringliteral}{    inside a class object seem problematic, though may be implement-able using }
215 \textcolor{stringliteral}{    reg\_copy -- but I'm not confident in state of regcopy of imported simuPop code,}
216 \textcolor{stringliteral}{    and so  I think is the safer solution, though it}
217 \textcolor{stringliteral}{    does create a depandancy of the pgguisimupop object on this outside def.  }
218 \textcolor{stringliteral}{}
219 \textcolor{stringliteral}{    Note that this def runs a simupop operation using all the param values as}
220 \textcolor{stringliteral}{    given in the config file arg, except for the "reps" attribute, with is reset to 1,}
221 \textcolor{stringliteral}{    whatever the value in the configuration file.}
222 \textcolor{stringliteral}{}
223 \textcolor{stringliteral}{    Tue Jul 26 22:01:07 MDT 2016}
224 \textcolor{stringliteral}{    updated to be called by a driver that creates a new OS process, then calls this def to do the
       replicate.  No longer}
225 \textcolor{stringliteral}{    uses the dv\_input\_parm\_values\_by\_attribute, but instead relies on reading a complete and up-to-date
       (i.e. all values}
226 \textcolor{stringliteral}{    as changed or edited on the gui interface) configuration files (that includes the "life table" params).}
227 \textcolor{stringliteral}{    '''}
228 
229     s\_tag\_out=\textcolor{stringliteral}{""}
230 
231     NUMBER\_FIRST\_REPLICATE=1
232 
233     \textcolor{stringliteral}{'''}
234 \textcolor{stringliteral}{    As of 2016\_08\_23 the *sim, *gen, *db files}
235 \textcolor{stringliteral}{    are not used, and clutter up the output directories,}
236 \textcolor{stringliteral}{    per other users comments}
237 \textcolor{stringliteral}{    '''}
238 
239     \textcolor{comment}{#whether or not to remove the *sim *gen *db}
240     \textcolor{comment}{#files (original output from Tiago's code ), }
241     \textcolor{comment}{#which leaves only a *conf and *genepop}
242     \textcolor{comment}{#files as output}
243 
244     REMOVE\_NON\_GENEPOP\_SIM\_OUTPUT\_FILES=\textcolor{keyword}{True}
245 
246     \textcolor{keywordflow}{if} i\_replicate\_number \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
247         s\_tag\_out=SIMULATION\_OUTPUT\_FILE\_REPLICATE\_TAG + str( i\_replicate\_number )
248 
249     \textcolor{comment}{#end if rep number is not none}
250 
251     o\_resources=pgrec.PGSimuPopResources( ls\_life\_table\_files )
252     o\_paramset=pgpar.PGParamSet( s\_param\_name\_file )
253     o\_input=pgin.PGInputSimuPop( s\_configuration\_file, o\_resources, o\_paramset ) 
254     o\_input.makeInputConfig()
255 
256     b\_write\_conf\_file=\textcolor{keyword}{False}
257 
258     \textcolor{comment}{#we only write the configuraton file if the replicate number is 1:}
259     \textcolor{keywordflow}{if} i\_replicate\_number == NUMBER\_FIRST\_REPLICATE:
260         b\_write\_conf\_file=\textcolor{keyword}{True}
261     \textcolor{comment}{#end if first replicate number}
262 
263     \textcolor{comment}{#reset reps to 1}
264     \textcolor{comment}{#as we are executing only one}
265     \textcolor{comment}{#replicate.  We assume this def}
266     \textcolor{comment}{#is being called as one of a number}
267     \textcolor{comment}{#of parallel process calls for}
268     \textcolor{comment}{#a set of replicates, the total }
269     \textcolor{comment}{#known to the caller:}
270     o\_input.reps=1
271 
272     o\_output=pgout.PGOutputSimuPop( s\_outfile\_basename )
273 
274     o\_new\_pgopsimupop\_instance=pgsim.PGOpSimuPop( o\_input,
275             o\_output, 
276             b\_remove\_db\_gen\_sim\_files=REMOVE\_NON\_GENEPOP\_SIM\_OUTPUT\_FILES,
277             b\_write\_input\_as\_config\_file=b\_write\_conf\_file )
278 
279     o\_new\_pgopsimupop\_instance.prepareOp( s\_tag\_out  )
280 
281     o\_new\_pgopsimupop\_instance.doOp()
282 
283     \textcolor{keywordflow}{return}
284 \textcolor{comment}{#end do\_pgopsimupop\_replicate\_from\_files}
285 
\end{DoxyCode}
\index{negui\+::pgutilities@{negui\+::pgutilities}!do\+\_\+usage\+\_\+check@{do\+\_\+usage\+\_\+check}}
\index{do\+\_\+usage\+\_\+check@{do\+\_\+usage\+\_\+check}!negui\+::pgutilities@{negui\+::pgutilities}}
\subsubsection[{\texorpdfstring{do\+\_\+usage\+\_\+check(ls\+\_\+this\+\_\+argv, ls\+\_\+required\+\_\+arg\+\_\+descriptions, ls\+\_\+optional\+\_\+arg\+\_\+descriptions=[], b\+\_\+multi\+\_\+line\+\_\+msg=\+False, b\+\_\+unlimited\+\_\+final\+\_\+args=\+False, s\+\_\+note=\+None)}{do_usage_check(ls_this_argv, ls_required_arg_descriptions, ls_optional_arg_descriptions=[], b_multi_line_msg=False, b_unlimited_final_args=False, s_note=None)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+pgutilities.\+do\+\_\+usage\+\_\+check (
\begin{DoxyParamCaption}
\item[{}]{ls\+\_\+this\+\_\+argv, }
\item[{}]{ls\+\_\+required\+\_\+arg\+\_\+descriptions, }
\item[{}]{ls\+\_\+optional\+\_\+arg\+\_\+descriptions = {\ttfamily \mbox{[}\mbox{]}}, }
\item[{}]{b\+\_\+multi\+\_\+line\+\_\+msg = {\ttfamily False}, }
\item[{}]{b\+\_\+unlimited\+\_\+final\+\_\+args = {\ttfamily False}, }
\item[{}]{s\+\_\+note = {\ttfamily None}}
\end{DoxyParamCaption}
)}\hypertarget{namespacenegui_1_1pgutilities_a20a66168135d35b6713e38b2503f6289}{}\label{namespacenegui_1_1pgutilities_a20a66168135d35b6713e38b2503f6289}
\begin{DoxyVerb}arg 1 expects sys.argv, or a copy
arg 2 expects a list strings, in order, required args
arg 3 expects a list of strings, in order, any optional args
\end{DoxyVerb}
 

Definition at line 48 of file pgutilities.\+py.


\begin{DoxyCode}
48             s\_note=\textcolor{keywordtype}{None}):
49     \textcolor{stringliteral}{'''}
50 \textcolor{stringliteral}{    arg 1 expects sys.argv, or a copy}
51 \textcolor{stringliteral}{    arg 2 expects a list strings, in order, required args}
52 \textcolor{stringliteral}{    arg 3 expects a list of strings, in order, any optional args}
53 \textcolor{stringliteral}{    '''}
54     i\_num\_args\_required = len( ls\_required\_arg\_descriptions )
55     i\_num\_args\_optional = len( ls\_optional\_arg\_descriptions )
56     i\_max\_poss\_num\_args = i\_num\_args\_required + i\_num\_args\_optional 
57     i\_num\_args\_passed = len( ls\_this\_argv ) - 1  
58     s\_usage\_string = \textcolor{stringliteral}{""}
59     s\_arg\_delimit=\textcolor{stringliteral}{""}
60     \textcolor{keywordflow}{if} b\_multi\_line\_msg == \textcolor{keyword}{True}:
61         s\_arg\_delimit=\textcolor{stringliteral}{"\(\backslash\)n"}
62     \textcolor{comment}{#end if we put each arg descript on a }
63     \textcolor{comment}{#separate line of output}
64 
65     \textcolor{keywordflow}{if} i\_num\_args\_passed <  i\_num\_args\_required  \(\backslash\)
66             \textcolor{keywordflow}{or} (i\_num\_args\_passed > i\_max\_poss\_num\_args \textcolor{keywordflow}{and} b\_unlimited\_final\_args == \textcolor{keyword}{False} ): 
67     
68         s\_scriptname = os.path.basename( ls\_this\_argv[ 0 ] )    
69         s\_usage\_string = \textcolor{stringliteral}{"usage: "} + s\_scriptname 
70 
71         \textcolor{keywordflow}{if} b\_multi\_line\_msg:
72             s\_usage\_string=\textcolor{stringliteral}{"usage: "} + s\_scriptname \(\backslash\)
73                     + \textcolor{stringliteral}{"\(\backslash\)nargs:\(\backslash\)n"}
74         \textcolor{keywordflow}{else}:
75             s\_usage\_string = \textcolor{stringliteral}{"usage: "} + s\_scriptname 
76         \textcolor{comment}{#end if multi line else not}
77 
78         \textcolor{keywordflow}{for} s\_arg \textcolor{keywordflow}{in} ls\_required\_arg\_descriptions:
79 
80             s\_usage\_string += \textcolor{stringliteral}{" <"} \(\backslash\)
81                 + s\_arg + \textcolor{stringliteral}{">"} \(\backslash\)
82                 + s\_arg\_delimit
83         \textcolor{comment}{#end for each requried arg}
84 
85         \textcolor{keywordflow}{for} s\_arg \textcolor{keywordflow}{in} ls\_optional\_arg\_descriptions:
86 
87             s\_usage\_string += \textcolor{stringliteral}{" <(optional) "} \(\backslash\)
88                 + s\_arg + \textcolor{stringliteral}{">"} \(\backslash\)
89                 + s\_arg\_delimit
90         \textcolor{comment}{#end for each required arg}
91 
92     \textcolor{comment}{#end if number of args is out of range}
93 
94     \textcolor{keywordflow}{if} s\_usage\_string != \textcolor{stringliteral}{""} \textcolor{keywordflow}{and} s\_note \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
95         s\_usage\_string=s\_usage\_string + \textcolor{stringliteral}{"\(\backslash\)n"} + s\_note
96     \textcolor{comment}{#end if note }
97 
98     \textcolor{keywordflow}{return}  s\_usage\_string 
99 \textcolor{comment}{#def do\_usage\_check}
100 
\end{DoxyCode}
\index{negui\+::pgutilities@{negui\+::pgutilities}!prep\+\_\+and\+\_\+call\+\_\+do\+\_\+pgopsimupop\+\_\+replicate@{prep\+\_\+and\+\_\+call\+\_\+do\+\_\+pgopsimupop\+\_\+replicate}}
\index{prep\+\_\+and\+\_\+call\+\_\+do\+\_\+pgopsimupop\+\_\+replicate@{prep\+\_\+and\+\_\+call\+\_\+do\+\_\+pgopsimupop\+\_\+replicate}!negui\+::pgutilities@{negui\+::pgutilities}}
\subsubsection[{\texorpdfstring{prep\+\_\+and\+\_\+call\+\_\+do\+\_\+pgopsimupop\+\_\+replicate(s\+\_\+config\+\_\+file, s\+\_\+life\+\_\+table\+\_\+files, s\+\_\+param\+\_\+file, s\+\_\+output\+\_\+base\+\_\+name, s\+\_\+replicate\+\_\+number)}{prep_and_call_do_pgopsimupop_replicate(s_config_file, s_life_table_files, s_param_file, s_output_base_name, s_replicate_number)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+pgutilities.\+prep\+\_\+and\+\_\+call\+\_\+do\+\_\+pgopsimupop\+\_\+replicate (
\begin{DoxyParamCaption}
\item[{}]{s\+\_\+config\+\_\+file, }
\item[{}]{s\+\_\+life\+\_\+table\+\_\+files, }
\item[{}]{s\+\_\+param\+\_\+file, }
\item[{}]{s\+\_\+output\+\_\+base\+\_\+name, }
\item[{}]{s\+\_\+replicate\+\_\+number}
\end{DoxyParamCaption}
)}\hypertarget{namespacenegui_1_1pgutilities_a33737d6b655651fd586e77e269300eb4}{}\label{namespacenegui_1_1pgutilities_a33737d6b655651fd586e77e269300eb4}


end do\+\_\+sim\+\_\+replicate\+\_\+on\+\_\+separate\+\_\+os\+\_\+process 

\begin{DoxyVerb}This def to be invoked in a subprocess.Popen command, as
instantiated in a PGGuiSimuPop instance in do_operation.

This def simply prepares the args for the call to def
do_pgopsimupop_replicate_from_files (below).
\end{DoxyVerb}
 

Definition at line 182 of file pgutilities.\+py.


\begin{DoxyCode}
182                         s\_replicate\_number ):
183     \textcolor{stringliteral}{''' }
184 \textcolor{stringliteral}{    This def to be invoked in a subprocess.Popen command, as}
185 \textcolor{stringliteral}{    instantiated in a PGGuiSimuPop instance in do\_operation.}
186 \textcolor{stringliteral}{}
187 \textcolor{stringliteral}{    This def simply prepares the args for the call to def}
188 \textcolor{stringliteral}{    do\_pgopsimupop\_replicate\_from\_files (below).}
189 \textcolor{stringliteral}{    '''}
190 
191     \textcolor{comment}{#de-stringify args for call to def below:}
192     ls\_life\_table\_files = s\_life\_table\_files.split( DELIMITER\_LIFE\_TABLE\_FILES )
193     i\_replicate\_number=int( s\_replicate\_number )
194 
195     \hyperlink{namespacenegui_1_1pgutilities_af3612d8b0b5d45a71109ea49eec4f9b0}{do\_pgopsimupop\_replicate\_from\_files}( s\_config\_file,
196                         ls\_life\_table\_files,
197                         s\_param\_file,
198                         s\_output\_base\_name,
199                         i\_replicate\_number )
200 
201     \textcolor{keywordflow}{return}
202 \textcolor{comment}{#end prep\_and\_call\_do\_pgopsimupop\_replicate}
203 
\end{DoxyCode}
\index{negui\+::pgutilities@{negui\+::pgutilities}!remove\+\_\+simulation\+\_\+replicate\+\_\+output\+\_\+files@{remove\+\_\+simulation\+\_\+replicate\+\_\+output\+\_\+files}}
\index{remove\+\_\+simulation\+\_\+replicate\+\_\+output\+\_\+files@{remove\+\_\+simulation\+\_\+replicate\+\_\+output\+\_\+files}!negui\+::pgutilities@{negui\+::pgutilities}}
\subsubsection[{\texorpdfstring{remove\+\_\+simulation\+\_\+replicate\+\_\+output\+\_\+files(s\+\_\+basename)}{remove_simulation_replicate_output_files(s_basename)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+pgutilities.\+remove\+\_\+simulation\+\_\+replicate\+\_\+output\+\_\+files (
\begin{DoxyParamCaption}
\item[{}]{s\+\_\+basename}
\end{DoxyParamCaption}
)}\hypertarget{namespacenegui_1_1pgutilities_aa37c7d125e4eaec2eeea639f53fa140d}{}\label{namespacenegui_1_1pgutilities_aa37c7d125e4eaec2eeea639f53fa140d}
\begin{DoxyVerb}When a sim is cancelled inside a PGGuiSimuPop
object, this def is called
to remove any output files produced by the
do_pgopsimupop_replicate_from_files
\end{DoxyVerb}
 

Definition at line 286 of file pgutilities.\+py.


\begin{DoxyCode}
286 \textcolor{keyword}{def }\hyperlink{namespacenegui_1_1pgutilities_aa37c7d125e4eaec2eeea639f53fa140d}{remove\_simulation\_replicate\_output\_files}( s\_basename ):
287     \textcolor{stringliteral}{'''}
288 \textcolor{stringliteral}{    When a sim is cancelled inside a PGGuiSimuPop}
289 \textcolor{stringliteral}{    object, this def is called}
290 \textcolor{stringliteral}{    to remove any output files produced by the}
291 \textcolor{stringliteral}{    do\_pgopsimupop\_replicate\_from\_files}
292 \textcolor{stringliteral}{    '''}
293 
294     \textcolor{comment}{#type is to coerce python 3, despite fact that any iterable}
295     \textcolor{comment}{#would probably suffice:}
296     ls\_output\_extentions=list( \(\backslash\)
297             pgout.PGOutputSimuPop.DICT\_OUTPUT\_FILE\_EXTENSIONS.values() )
298 
299     \textcolor{keywordflow}{for} s\_ext \textcolor{keywordflow}{in} ls\_output\_extentions:
300 
301         s\_unzipped\_file\_pattern=s\_basename + \textcolor{stringliteral}{"*"} \(\backslash\)
302                 + SIMULATION\_OUTPUT\_FILE\_REPLICATE\_TAG \(\backslash\)
303                 + \textcolor{stringliteral}{"*"} + s\_ext
304 
305         ls\_files\_unzipped=glob.glob( s\_unzipped\_file\_pattern )
306 
307         ls\_files\_zipped=glob.glob( s\_unzipped\_file\_pattern \(\backslash\)
308                 + \textcolor{stringliteral}{"."} + pgout.PGOutputSimuPop.COMPRESSION\_FILE\_EXTENSION )
309 
310         \textcolor{keywordflow}{for} s\_file \textcolor{keywordflow}{in} ls\_files\_unzipped + ls\_files\_zipped:
311             os.remove( s\_file )
312         \textcolor{comment}{#end for each unzipped and zipped output file with this extension}
313     \textcolor{comment}{#end for each file ext}
314 
315     \textcolor{keywordflow}{return}
316 \textcolor{comment}{#end remove\_simulation\_replicate\_output\_files}
317 
\end{DoxyCode}
\index{negui\+::pgutilities@{negui\+::pgutilities}!run\+\_\+driveneestimator\+\_\+in\+\_\+new\+\_\+process@{run\+\_\+driveneestimator\+\_\+in\+\_\+new\+\_\+process}}
\index{run\+\_\+driveneestimator\+\_\+in\+\_\+new\+\_\+process@{run\+\_\+driveneestimator\+\_\+in\+\_\+new\+\_\+process}!negui\+::pgutilities@{negui\+::pgutilities}}
\subsubsection[{\texorpdfstring{run\+\_\+driveneestimator\+\_\+in\+\_\+new\+\_\+process(o\+\_\+multiprocessing\+\_\+event, s\+\_\+genepop\+\_\+files, qs\+\_\+sample\+\_\+scheme\+\_\+args, f\+\_\+min\+\_\+allele\+\_\+freq, i\+\_\+replicates, s\+\_\+loci\+\_\+sampling\+\_\+scheme, s\+\_\+loci\+\_\+sampling\+\_\+scheme\+\_\+param, i\+\_\+min\+\_\+loci\+\_\+position, i\+\_\+max\+\_\+loci\+\_\+position, i\+\_\+max\+\_\+total\+\_\+loci, i\+\_\+num\+\_\+processes, s\+\_\+runmode, s\+\_\+outfile\+\_\+basename, s\+\_\+file\+\_\+delimiter="")}{run_driveneestimator_in_new_process(o_multiprocessing_event, s_genepop_files, qs_sample_scheme_args, f_min_allele_freq, i_replicates, s_loci_sampling_scheme, s_loci_sampling_scheme_param, i_min_loci_position, i_max_loci_position, i_max_total_loci, i_num_processes, s_runmode, s_outfile_basename, s_file_delimiter=")}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+pgutilities.\+run\+\_\+driveneestimator\+\_\+in\+\_\+new\+\_\+process (
\begin{DoxyParamCaption}
\item[{}]{o\+\_\+multiprocessing\+\_\+event, }
\item[{}]{s\+\_\+genepop\+\_\+files, }
\item[{}]{qs\+\_\+sample\+\_\+scheme\+\_\+args, }
\item[{}]{f\+\_\+min\+\_\+allele\+\_\+freq, }
\item[{}]{i\+\_\+replicates, }
\item[{}]{s\+\_\+loci\+\_\+sampling\+\_\+scheme, }
\item[{}]{s\+\_\+loci\+\_\+sampling\+\_\+scheme\+\_\+param, }
\item[{}]{i\+\_\+min\+\_\+loci\+\_\+position, }
\item[{}]{i\+\_\+max\+\_\+loci\+\_\+position, }
\item[{}]{i\+\_\+max\+\_\+total\+\_\+loci, }
\item[{}]{i\+\_\+num\+\_\+processes, }
\item[{}]{s\+\_\+runmode, }
\item[{}]{s\+\_\+outfile\+\_\+basename, }
\item[{}]{s\+\_\+file\+\_\+delimiter = {\ttfamily \char`\"{}}}
\end{DoxyParamCaption}
)}\hypertarget{namespacenegui_1_1pgutilities_a4e8f98e83b41d19925860876d274beaa}{}\label{namespacenegui_1_1pgutilities_a4e8f98e83b41d19925860876d274beaa}
\begin{DoxyVerb}Similar to def above, "do_operation_outside," this def is called from a
PGGuiNeEstimator instance, in def runEstimator(), which first spawns
a python multiprocessing.Process, which targest this def, and provides
it with the multiprocessing.Event that will signal it to abort and cleanup
(see above).

This def is simpler than the do_operation_outside def, however, in that it
spawns only a single OS process, that calls python to execute pgdriveneestimator.py,
which itself multiplexes the NeAnlaysis of multiple genepop files and (likely) multiple
pops per file using python.multiprocessing.Process objects.
\end{DoxyVerb}
 

Definition at line 627 of file pgutilities.\+py.


\begin{DoxyCode}
627                                         s\_file\_delimiter=\textcolor{stringliteral}{","} ):
628     \textcolor{stringliteral}{'''}
629 \textcolor{stringliteral}{    Similar to def above, "do\_operation\_outside," this def is called from a}
630 \textcolor{stringliteral}{    PGGuiNeEstimator instance, in def runEstimator(), which first spawns}
631 \textcolor{stringliteral}{    a python multiprocessing.Process, which targest this def, and provides}
632 \textcolor{stringliteral}{    it with the multiprocessing.Event that will signal it to abort and cleanup}
633 \textcolor{stringliteral}{    (see above).}
634 \textcolor{stringliteral}{}
635 \textcolor{stringliteral}{    This def is simpler than the do\_operation\_outside def, however, in that it}
636 \textcolor{stringliteral}{    spawns only a single OS process, that calls python to execute pgdriveneestimator.py,}
637 \textcolor{stringliteral}{    which itself multiplexes the NeAnlaysis of multiple genepop files and (likely) multiple}
638 \textcolor{stringliteral}{    pops per file using python.multiprocessing.Process objects.}
639 \textcolor{stringliteral}{    '''}
640 
641     s\_os\_plaform\_name=platform.system()
642     
643     \textcolor{comment}{#if we're on windows, file}
644     \textcolor{comment}{#paths may be a mangled mix of unix and }
645     \textcolor{comment}{#windows separators -- with errors resulting}
646     \textcolor{comment}{#downstream.  So we standardize:}
647     \textcolor{keywordflow}{if} s\_os\_plaform\_name == \textcolor{stringliteral}{"windows"}:
648 
649         ls\_current\_file\_list=s\_genepop\_files.split( s\_file\_delimiter )
650         ls\_new\_file\_list=[]
651         \textcolor{keywordflow}{for} s\_file \textcolor{keywordflow}{in} ls\_current\_file\_list:
652             ls\_new\_file\_list.append( fix\_windows\_path( s\_file ) )
653         \textcolor{comment}{#end for each file}
654         
655         \textcolor{comment}{#replace orig arg with new "fixed" file paths}
656         s\_genepop\_files=\textcolor{stringliteral}{","}.join( ls\_new\_file\_list )
657 
658         \textcolor{comment}{#also need to fix outile path:}
659         s\_outfile\_basename = fix\_windows\_path( s\_outfile\_basename )
660     \textcolor{comment}{#end if windows, fix file path strings}
661 
662     \textcolor{comment}{#get the correct format for pgdriveneestimator.py's file name parsing alg:}
663     s\_genepop\_files\_formatted\_as\_python\_list= \(\backslash\)
664             \hyperlink{namespacenegui_1_1pgutilities_aed0f15b22462914445ffe1ec2a77cbc8}{convert\_genepop\_files\_string\_to\_list\_format}( 
      s\_genepop\_files )
665 
666     \textcolor{comment}{#caller, assumed to be a pgguineestimator instance,}
667     \textcolor{comment}{#will have "default" for the runmode val, }
668     \textcolor{comment}{#when no extra output is desired, and multiprocessing is also}
669     \textcolor{comment}{#desired.  We convert to the proper term used by pgdriveneestimator.py}
670     \textcolor{comment}{#to designate this type of run:}
671     \textcolor{keywordflow}{if} s\_runmode==\textcolor{stringliteral}{"default"}:
672         s\_runmode=\textcolor{stringliteral}{"no\_debug"}
673     \textcolor{comment}{#end if default runmode}
674 
675     \textcolor{comment}{#Make of a single sequence of strings.}
676     qs\_files\_args=( s\_genepop\_files\_formatted\_as\_python\_list, ) 
677 
678     s\_loci\_range=\textcolor{stringliteral}{"-"}.join( [ str( i\_min\_loci\_position ),
679                                 str( i\_max\_loci\_position ) ] )
680 
681     qs\_terminal\_args=( str( f\_min\_allele\_freq ), 
682                                 str( i\_replicates ), 
683                                 s\_loci\_sampling\_scheme,
684                                 s\_loci\_sampling\_scheme\_param,
685                                 s\_loci\_range,
686                                 str( i\_max\_total\_loci ),
687                                 str( i\_num\_processes ), 
688                                 s\_runmode )
689 
690     seq\_arg\_set=qs\_files\_args \(\backslash\)
691                     + qs\_sample\_scheme\_args \(\backslash\)
692                     + qs\_terminal\_args
693 
694     s\_main\_output\_filename=s\_outfile\_basename + \textcolor{stringliteral}{"."} \(\backslash\)
695             + NE\_ESTIMATION\_MAIN\_TABLE\_FILE\_EXT
696 
697     s\_secondary\_output\_filename=s\_outfile\_basename + \textcolor{stringliteral}{"."} \(\backslash\)
698             + NE\_ESTIMATION\_SECONDARY\_OUTPUT\_FILE\_EXT
699 
700     \textcolor{comment}{#pgdriveneestimator will write stdout and stderr, respectively}
701     \textcolor{comment}{#to these files:}
702     o\_main\_output=open( s\_main\_output\_filename, \textcolor{stringliteral}{'w'} )
703     o\_secondary\_output=open( s\_secondary\_output\_filename, \textcolor{stringliteral}{'w'} )
704 
705     seq\_arg\_set += ( o\_main\_output, o\_secondary\_output )
706     
707     \textcolor{comment}{#the driver also takes a final arg, ref to}
708     \textcolor{comment}{#the multiproc event -- and then checks for }
709     \textcolor{comment}{#it being set during map\_async when using multiprocesses}
710     \textcolor{comment}{#(see pgdriveneestimator.py def execute\_ne\_for\_each\_sample):}
711     seq\_arg\_set += ( o\_multiprocessing\_event, )
712 
713     pgne.mymain( *seq\_arg\_set )
714 
715     o\_main\_output.close()
716     o\_secondary\_output.close()
717 
718     \textcolor{keywordflow}{return}
719 \textcolor{comment}{#end run\_driveneestimator\_in\_new\_process}
720 
\end{DoxyCode}
