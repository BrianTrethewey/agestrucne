\hypertarget{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts}{}\section{negui.\+genepopfilesampler.\+Genepop\+File\+Sampler\+Cohorts Class Reference}
\label{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts}\index{negui.\+genepopfilesampler.\+Genepop\+File\+Sampler\+Cohorts@{negui.\+genepopfilesampler.\+Genepop\+File\+Sampler\+Cohorts}}
Inheritance diagram for negui.\+genepopfilesampler.\+Genepop\+File\+Sampler\+Cohorts\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def {\bfseries \+\_\+\+\_\+init\+\_\+\+\_\+} (self, o\+\_\+genepopfilemanager, o\+\_\+genepopfilesampleparams)\hypertarget{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a2b4fa2321a676910d8b11ec2df48fbbf}{}\label{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a2b4fa2321a676910d8b11ec2df48fbbf}

\item 
def \hyperlink{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a765e68f8d835bde418cd8c3005b0a97a}{resize\+\_\+sample\+\_\+to\+\_\+meet\+\_\+size\+\_\+criteria} (self, li\+\_\+indiv\+\_\+by\+\_\+age\+\_\+collected)
\item 
def \hyperlink{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a36977cef305c268768a1ede56ab7fc63}{do\+Sample} (self)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}This sampler class is meant to implement Tiago's sampling code in his
sampleIndivsCohort.py module.  It samples  individuals grouped by age.
The GenepopFileSampleParams object used by instances
of this class has the values Tiagos module takes at the command line 
that restrict the total individuals per gen.  His command line params 
startGen and endGen paramters are already implemented via the Sampler's
li_population_numbers parameter.


2017_07_21.  This class is copied from original version named class
GenepopFileSamplerIndividualsAgeStructureCohorts, and revised to 
handle subsample values using the (new class) GenepopFileSampleParamsCohorts,
which will store lists of proportions and/or indiv count limits.  Further,
this class will use these values (if present) to subsample the already
evenly sampled age classes 0,1...max_age, again, evenly across the age classes.
Note that before this revision, the only subsampling applied (proportion,
via class GenepopFileSamplerIndividualsAgeStructureCohortsPercentage),
sampled a proportion of the pooled age classes, so that the final sample,
if representing multiple age classes, was likely biased towards/against 
one or another across age class).
\end{DoxyVerb}
 

Definition at line 813 of file genepopfilesampler.\+py.



\subsection{Member Function Documentation}
\index{negui\+::genepopfilesampler\+::\+Genepop\+File\+Sampler\+Cohorts@{negui\+::genepopfilesampler\+::\+Genepop\+File\+Sampler\+Cohorts}!do\+Sample@{do\+Sample}}
\index{do\+Sample@{do\+Sample}!negui\+::genepopfilesampler\+::\+Genepop\+File\+Sampler\+Cohorts@{negui\+::genepopfilesampler\+::\+Genepop\+File\+Sampler\+Cohorts}}
\subsubsection[{\texorpdfstring{do\+Sample(self)}{doSample(self)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+genepopfilesampler.\+Genepop\+File\+Sampler\+Cohorts.\+do\+Sample (
\begin{DoxyParamCaption}
\item[{}]{self}
\end{DoxyParamCaption}
)}\hypertarget{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a36977cef305c268768a1ede56ab7fc63}{}\label{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a36977cef305c268768a1ede56ab7fc63}
\begin{DoxyVerb}Sample identical numbers per age, then reduce to meet max indiv per gen or proportion.  
See Tiagos code in his sampleIndivsCohort.py module.  Note that when param 
"lp" is included, then Tiagos code adds to his lines that print out, gen_number\sindiv, 
the same lines without a gen number, presumably for downstream filtering when making the final
genenpop file. As of 2016_09_12, the output when the "lp" arg is added, is not 
implemented.

2017_07_21. For this revised version of original class 
GenepopFileSamplerIndividualsAgeStructureCohorts, we use the member of new 
class GenepopFileSampleParamsCohorts, list_of_sampling_values, to loop over
proportion (or count--not yet implemented) subsample values (if any), and 
add a pop subsample tag for each value.  This is an incorporation of the 
original doSample, with the looping logic of the doSample in the original
class GenepopFileSamplerIndividualsAgeStructureCohortsPercentage.
\end{DoxyVerb}
 

Definition at line 972 of file genepopfilesampler.\+py.


\begin{DoxyCode}
972     \textcolor{keyword}{def }\hyperlink{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a36977cef305c268768a1ede56ab7fc63}{doSample}( self ):
973         \textcolor{stringliteral}{'''}
974 \textcolor{stringliteral}{        Sample identical numbers per age, then reduce to meet max indiv per gen or proportion.  }
975 \textcolor{stringliteral}{        See Tiagos code in his sampleIndivsCohort.py module.  Note that when param }
976 \textcolor{stringliteral}{        "lp" is included, then Tiagos code adds to his lines that print out, gen\_number\(\backslash\)sindiv, }
977 \textcolor{stringliteral}{        the same lines without a gen number, presumably for downstream filtering when making the final}
978 \textcolor{stringliteral}{        genenpop file. As of 2016\_09\_12, the output when the "lp" arg is added, is not }
979 \textcolor{stringliteral}{        implemented.}
980 \textcolor{stringliteral}{}
981 \textcolor{stringliteral}{        2017\_07\_21. For this revised version of original class }
982 \textcolor{stringliteral}{        GenepopFileSamplerIndividualsAgeStructureCohorts, we use the member of new }
983 \textcolor{stringliteral}{        class GenepopFileSampleParamsCohorts, list\_of\_sampling\_values, to loop over}
984 \textcolor{stringliteral}{        proportion (or count--not yet implemented) subsample values (if any), and }
985 \textcolor{stringliteral}{        add a pop subsample tag for each value.  This is an incorporation of the }
986 \textcolor{stringliteral}{        original doSample, with the looping logic of the doSample in the original}
987 \textcolor{stringliteral}{        class GenepopFileSamplerIndividualsAgeStructureCohortsPercentage.}
988 \textcolor{stringliteral}{        '''}
989 
990         \textcolor{comment}{#estimator driver needs a pop number subsample when it adds calls to the NeEstimator:}
991         self.filemanager.subsamplePopulationsByList( self.sampleparams.population\_numbers,
992                                         s\_subsample\_tag=self.sampleparams.population\_subsample\_name )
993 
994         FIELD\_NAME\_AGE=\textcolor{stringliteral}{"age"}
995 
996         \textcolor{stringliteral}{'''}
997 \textcolor{stringliteral}{        If we are processing a session with No }
998 \textcolor{stringliteral}{        subsampling values, we will pass self.\_\_get\_individuals}
999 \textcolor{stringliteral}{        "None"}
1000 \textcolor{stringliteral}{        '''}
1001         lo\_sampling\_value\_objects\_list=[ \textcolor{keywordtype}{None} ]
1002 
1003         \textcolor{keywordflow}{if} self.sampleparams.list\_of\_sampling\_values \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
1004             lo\_sampling\_value\_objects\_list=self.sampleparams.list\_of\_sampling\_values
1005         \textcolor{comment}{#end if no samping value (i.e. schem is "none") else we have them}
1006 
1007         \textcolor{keywordflow}{for} o\_sampling\_value\_object \textcolor{keywordflow}{in} lo\_sampling\_value\_objects\_list:
1008             
1009             dli\_indiv\_index\_lists\_by\_pop\_number=\{\}
1010             
1011             i\_replicate\_count=self.sampleparams.replicates
1012 
1013             \textcolor{keywordflow}{for} i\_replicate\_number \textcolor{keywordflow}{in} range( i\_replicate\_count ):
1014 
1015                 \textcolor{keywordflow}{for} i\_pop\_number \textcolor{keywordflow}{in} self.sampleparams.population\_numbers:
1016 
1017                     ls\_id\_list=self.filemanager.getListIndividuals( i\_pop\_number )
1018 
1019                     \textcolor{stringliteral}{'''}
1020 \textcolor{stringliteral}{                    We assume that the list of Id's in the individual list}
1021 \textcolor{stringliteral}{                    is indexed such that the zeroth id corresponds to the first}
1022 \textcolor{stringliteral}{                    indiv as ordered in the genepop file, the [1] indexed id}
1023 \textcolor{stringliteral}{                    is the second indiv, etc.}
1024 \textcolor{stringliteral}{                    '''}
1025                     i\_tot\_indiv=len( ls\_id\_list )
1026 
1027                     dli\_indiv\_index\_by\_age=\{\}
1028                     
1029                     \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range( i\_tot\_indiv ):
1030 
1031                         s\_id=ls\_id\_list[ idx ]
1032 
1033                         o\_id\_vals=GenepopIndivIdVals( s\_id, 
1034                                             self.sampleparams.fields )
1035                         
1036                         \textcolor{comment}{#age may be float or int:}
1037                         v\_age=o\_id\_vals.getVal( FIELD\_NAME\_AGE )
1038 
1039                         \textcolor{keywordflow}{if} v\_age > self.sampleparams.max\_age:
1040                             \textcolor{keywordflow}{continue}
1041                         \textcolor{comment}{#end if too old, continue}
1042 
1043                         \textcolor{stringliteral}{'''}
1044 \textcolor{stringliteral}{                        Note that idx+1 gives the number of the individual as ordered by its}
1045 \textcolor{stringliteral}{                        entry in the "pop" section of this pop in the genepop file, as used}
1046 \textcolor{stringliteral}{                        by the genepopfilemanager object to point to it's byte address in the file.}
1047 \textcolor{stringliteral}{                        Thus it's our way of collecting samples of individuals and passing them into the}
1048 \textcolor{stringliteral}{                        genepop file manager object's subsampling records (its attribute }
1049 \textcolor{stringliteral}{                        \_\_indiv\_subsamples).}
1050 \textcolor{stringliteral}{                        '''}
1051 
1052                         i\_indiv\_number=idx+1
1053 
1054                         dli\_indiv\_index\_by\_age.setdefault( \(\backslash\)
1055                                     v\_age, [] ).append( i\_indiv\_number ) 
1056 
1057                     \textcolor{comment}{#end for each individual's id   }
1058 
1059                     li\_indiv\_by\_age\_collected=self.\hyperlink{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a1b370307615aa6267a6f287180030058}{\_\_get\_individuals}( \(\backslash\)
1060                                                     dli\_indiv\_index\_by\_age,
1061                                                     o\_sampling\_value\_object ) 
1062                 
1063                     \textcolor{stringliteral}{'''}
1064 \textcolor{stringliteral}{                    2017\_07\_21.  We note that, for now, this call will simply throw }
1065 \textcolor{stringliteral}{                    an error if the current sample (pooled individuals from all age classes,}
1066 \textcolor{stringliteral}{                    with any proportion or count subsample value also applied,}
1067 \textcolor{stringliteral}{                    '''}
1068                     li\_indiv\_by\_age\_sampled=self.
      \hyperlink{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a765e68f8d835bde418cd8c3005b0a97a}{resize\_sample\_to\_meet\_size\_criteria}( 
1069                                                                 li\_indiv\_by\_age\_collected ) 
1070 
1071                     \textcolor{comment}{#We rely on the genpopfilemanager object to sort }
1072                     \textcolor{comment}{#these indices when we pass them to the def,}
1073                     \textcolor{comment}{#subsampleIndividualsByNumberList (see below).}
1074                     dli\_indiv\_index\_lists\_by\_pop\_number[ i\_pop\_number ] = \(\backslash\)
1075                                                         li\_indiv\_by\_age\_sampled
1076                 \textcolor{comment}{#end for each pop number}
1077 
1078                 \textcolor{keywordflow}{if} o\_sampling\_value\_object \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
1079                     self.sampleparams.sample\_param\_value=\(\backslash\)
1080                             str( o\_sampling\_value\_object.sampling\_value )
1081                 \textcolor{comment}{#end if we have a sampling value}
1082                 
1083                 s\_this\_subsample\_name=make\_subsample\_tag( \(\backslash\)
1084                                     self.sampleparams.sample\_param\_value, 
1085                                     i\_replicate\_number, 
1086                                     SCHEME\_COHORTS,
1087                                     s\_prefix=self.sampleparams.sample\_tag\_base )
1088                 
1089                 self.filemanager.subsampleIndividualsByNumberList( \(\backslash\)
1090                                         dli\_indiv\_index\_lists\_by\_pop\_number,
1091                                         s\_this\_subsample\_name )
1092             \textcolor{comment}{#end for each replicate}
1093         \textcolor{comment}{#end for each  sampling value}
1094         \textcolor{keywordflow}{return}
\end{DoxyCode}
\index{negui\+::genepopfilesampler\+::\+Genepop\+File\+Sampler\+Cohorts@{negui\+::genepopfilesampler\+::\+Genepop\+File\+Sampler\+Cohorts}!resize\+\_\+sample\+\_\+to\+\_\+meet\+\_\+size\+\_\+criteria@{resize\+\_\+sample\+\_\+to\+\_\+meet\+\_\+size\+\_\+criteria}}
\index{resize\+\_\+sample\+\_\+to\+\_\+meet\+\_\+size\+\_\+criteria@{resize\+\_\+sample\+\_\+to\+\_\+meet\+\_\+size\+\_\+criteria}!negui\+::genepopfilesampler\+::\+Genepop\+File\+Sampler\+Cohorts@{negui\+::genepopfilesampler\+::\+Genepop\+File\+Sampler\+Cohorts}}
\subsubsection[{\texorpdfstring{resize\+\_\+sample\+\_\+to\+\_\+meet\+\_\+size\+\_\+criteria(self, li\+\_\+indiv\+\_\+by\+\_\+age\+\_\+collected)}{resize_sample_to_meet_size_criteria(self, li_indiv_by_age_collected)}}]{\setlength{\rightskip}{0pt plus 5cm}def negui.\+genepopfilesampler.\+Genepop\+File\+Sampler\+Cohorts.\+resize\+\_\+sample\+\_\+to\+\_\+meet\+\_\+size\+\_\+criteria (
\begin{DoxyParamCaption}
\item[{}]{self, }
\item[{}]{li\+\_\+indiv\+\_\+by\+\_\+age\+\_\+collected}
\end{DoxyParamCaption}
)}\hypertarget{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a765e68f8d835bde418cd8c3005b0a97a}{}\label{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a765e68f8d835bde418cd8c3005b0a97a}
\begin{DoxyVerb}Given the individuals collected by age, 
check min/max limits and subsample
if needed.  If within limits, return
the original list
\end{DoxyVerb}
 

Definition at line 921 of file genepopfilesampler.\+py.


\begin{DoxyCode}
921     \textcolor{keyword}{def }\hyperlink{classnegui_1_1genepopfilesampler_1_1GenepopFileSamplerCohorts_a765e68f8d835bde418cd8c3005b0a97a}{resize\_sample\_to\_meet\_size\_criteria}( self, 
      li\_indiv\_by\_age\_collected ):
922         \textcolor{stringliteral}{'''}
923 \textcolor{stringliteral}{        Given the individuals collected by age, }
924 \textcolor{stringliteral}{        check min/max limits and subsample}
925 \textcolor{stringliteral}{        if needed.  If within limits, return}
926 \textcolor{stringliteral}{        the original list}
927 \textcolor{stringliteral}{        '''}
928 
929         \textcolor{comment}{#If too few we raise an error.  If too many we}
930         \textcolor{comment}{#randomly select to reach our max valid pop size}
931         i\_tot\_collected=len( li\_indiv\_by\_age\_collected )
932 
933         li\_indiv\_by\_age\_sampled=\textcolor{keywordtype}{None}
934 
935         \textcolor{keywordflow}{if} i\_tot\_collected < self.sampleparams.min\_indiv\_per\_gen:
936             s\_msg=\textcolor{stringliteral}{"In GenepopFileSamplerIndividualsAgeStructureCohorts instance, "} \(\backslash\)
937                     \textcolor{stringliteral}{"after sampling cohorts, total collected, "} \(\backslash\)
938                     + str( i\_tot\_collected ) \(\backslash\)
939                     + \textcolor{stringliteral}{", is less than the value given for "} \(\backslash\)
940                     + \textcolor{stringliteral}{"the minimum pop size, "} \(\backslash\)
941                     + str( self.sampleparams.min\_indiv\_per\_gen ) \(\backslash\)
942                     + \textcolor{stringliteral}{"."}
943             \textcolor{keywordflow}{raise} Exception ( s\_msg )
944 
945         \textcolor{keywordflow}{elif} i\_tot\_collected > self.sampleparams.max\_indiv\_per\_gen:
946             \textcolor{keywordflow}{try}:
947 
948                 li\_indiv\_by\_age\_sampled=random.sample( \(\backslash\)
949                                     li\_indiv\_by\_age\_collected,
950                                     self.sampleparams.max\_indiv\_per\_gen )
951                                         
952             \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} oex:
953                 s\_sample\_error\_msg= \(\backslash\)
954                     \textcolor{stringliteral}{"In GenepopFileSamplerIndividualsAgeStructureCohorts "} \(\backslash\)
955                         + \textcolor{stringliteral}{"instance, def resize\_sample\_to\_meet\_size\_criteria, "}  \(\backslash\)
956                         + \textcolor{stringliteral}{"random.sample failed on list of "} \(\backslash\)
957                         + str( len( li\_indiv\_by\_age\_collected ) ) \(\backslash\)
958                         + \textcolor{stringliteral}{" individuals.  Target total to be sampled: "} \(\backslash\)
959                         + str( self.sampleparams.max\_indiv\_per\_gen ) + \textcolor{stringliteral}{"."}
960                 s\_msg=s\_sample\_error\_msg \(\backslash\)
961                         + \textcolor{stringliteral}{"  Exception message: "} + str( oex ) + \textcolor{stringliteral}{"."}
962                 \textcolor{keywordflow}{raise} Exception( s\_msg )
963             \textcolor{comment}{#end try . . . except}
964         \textcolor{keywordflow}{else}:
965             \textcolor{comment}{#within interval min to max pop size, so keep original }
966             li\_indiv\_by\_age\_sampled=li\_indiv\_by\_age\_collected
967 
968         \textcolor{comment}{#end if too few, error, else if too many, sample, else no change}
969         \textcolor{keywordflow}{return} li\_indiv\_by\_age\_sampled
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
genepopfilesampler.\+py\end{DoxyCompactItemize}
